# 📊 代码可视化分析器

> 🚀 一个现代化的Web界面，专为代码浏览、项目分析和AI辅助开发设计，支持智能项目管理和拖拽排序

[![Node.js](https://img.shields.io/badge/Node.js-18.x-green.svg)](https://nodejs.org/)
[![Express](https://img.shields.io/badge/Express-4.18.x-blue.svg)](https://expressjs.com/)
[![SQLite](https://img.shields.io/badge/SQLite-3.x-orange.svg)](https://www.sqlite.org/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![AI-Powered](https://img.shields.io/badge/AI-DeepSeek-purple.svg)](https://www.deepseek.com/)

## ✨ 核心特性

### 🎯 智能项目管理
- **多项目支持**: 同时管理和切换多个代码项目
- **🎪 拖拽排序**: 支持项目列表的直观拖拽重新排序
- **动态项目添加**: 通过界面快速添加本地项目目录
- **项目状态管理**: 实时显示项目分析状态和重组配置
- **SQLite数据库**: 项目信息持久化存储，支持删除和管理

### 🎪 拖拽排序功能 (NEW!)
- **直观操作**: 通过拖拽手柄(⋮⋮)重新排列项目顺序
- **视觉反馈**: 拖拽过程中的动画效果和状态提示
- **双向排序**: 支持向上和向下拖拽排序
- **实时保存**: 排序结果自动保存到localStorage
- **跨会话保持**: 刷新页面后排序保持不变

### 📏 文件树调整大小 (NEW!)
- **高度调整**: 拖拽文件树底部边缘调整显示高度
- **智能限制**: 最小200px，最大800px或屏幕高度60%
- **双击重置**: 双击调整手柄快速重置为默认高度
- **设置保存**: 调整后的高度自动保存，重启保持
- **展开折叠**: 一键展开或折叠所有文件夹

### 📐 侧边栏宽度调整 (NEW!)
- **宽度调整**: 拖拽侧边栏右边缘调整整体宽度
- **智能限制**: 最小280px，最大800px或屏幕宽度60%
- **双击重置**: 双击调整手柄快速重置为默认宽度
- **设置保存**: 调整后的宽度自动保存，重启保持
- **响应式**: 移动端自动隐藏调整功能，全宽显示

### 🧠 AI驱动分析
- **智能项目分析**: 使用DeepSeek AI深度分析项目结构和代码质量
- **目录重组建议**: AI生成的智能目录结构优化方案
- **重复分析检测**: 自动检测已分析项目，避免重复分析
- **持久化配置**: 分析结果和重组配置永久保存

### 🎨 现代化界面
- **Apple风格设计**: 采用现代glassmorphism效果和渐变设计
- **响应式布局**: 适配各种屏幕尺寸，完美的移动端体验
- **代码语法高亮**: 支持30+编程语言的语法高亮显示
- **智能搜索**: 全项目代码搜索，支持关键词高亮

### 🔐 安全可靠
- **JWT身份验证**: 基于Token的安全认证机制
- **文件路径验证**: 严格的文件访问权限控制
- **API密钥管理**: 安全的AI服务配置和管理
- **SQLite数据库**: 本地化数据存储，保护用户隐私

## 🚀 快速开始

### 环境要求
- Node.js 16.x 或更高版本
- npm 或 yarn 包管理器
- 支持现代JavaScript的浏览器

### 安装与启动

```bash
# 克隆项目
git clone https://github.com/rrrrr9633/code-web-dashboard.git
cd code-web-dashboard

# 安装依赖
npm install

# 启动服务器
npm start

# 或者使用开发模式（自动重启）
npm run dev
```

### 首次配置

1. 打开浏览器访问 `http://localhost:3000`
2. 使用默认密码 `flowmq2024` 登录系统
3. 配置DeepSeek AI API密钥以启用AI功能
4. 添加您的第一个项目开始分析

## 🎮 使用指南

### 项目管理
- **添加项目**: 点击"添加项目"按钮，输入项目名称和本地路径
- **切换项目**: 在左侧项目列表中点击项目名称
- **拖拽排序**: 鼠标悬停在项目上，拖拽左侧的手柄图标(⋮⋮)进行排序
- **项目操作**: 支持重命名、刷新、删除项目

### 🎪 拖拽排序操作详解
1. **定位拖拽手柄**: 鼠标悬停在项目列表项上，左侧会显示拖拽手柄(⋮⋮)
2. **开始拖拽**: 点击并按住拖拽手柄开始拖拽
3. **排序操作**: 
   - 向上拖拽：将项目移动到列表上方
   - 向下拖拽：将项目移动到列表下方
4. **视觉反馈**: 拖拽过程中项目会变半透明，目标位置会高亮
5. **完成排序**: 释放鼠标完成排序，系统会显示成功通知

### AI分析功能
1. **项目分析**: 选择项目后点击"项目分析"获得AI生成的项目结构分析
2. **智能检测**: 系统自动检测已分析项目，提供查看现有结果或重新分析的选项
3. **目录重组**: 应用AI建议的目录结构优化方案
4. **状态管理**: 查看项目分析状态，随时重置为原始结构

### 代码浏览
- **文件树导航**: 在左侧面板浏览项目文件结构
- **代码查看**: 点击文件查看带语法高亮的代码内容
- **全局搜索**: 使用顶部搜索框在整个项目中搜索代码

### 📏 文件树大小调整操作详解
1. **调整高度**: 将鼠标移动到文件树底部，出现调整手柄
2. **拖拽操作**: 点击并拖拽底部的调整手柄上下移动
3. **智能限制**: 系统自动限制最小高度200px，最大高度800px
4. **双击重置**: 双击调整手柄快速恢复默认高度(400px)
5. **设置保存**: 调整完成后高度自动保存到本地存储

### 📐 侧边栏宽度调整操作详解
1. **调整宽度**: 将鼠标移动到侧边栏右边缘，出现调整手柄
2. **拖拽操作**: 点击并拖拽右侧的调整手柄左右移动
3. **智能限制**: 系统自动限制最小宽度280px，最大宽度800px
4. **双击重置**: 双击调整手柄快速恢复默认宽度(380px)
5. **设置保存**: 调整完成后宽度自动保存到本地存储

## 🏗️ 技术架构

### 前端技术栈
```
HTML5 + CSS3 + Vanilla JavaScript
├── UI框架: 原生JavaScript + 现代CSS
├── 样式: Glassmorphism + Apple设计语言
├── 拖拽: HTML5 Drag & Drop API
├── 数据存储: localStorage + fetch API
├── 代码高亮: Highlight.js
├── Markdown渲染: Marked.js
└── 图标: Font Awesome
```

### 后端技术栈
```
Node.js + Express.js + SQLite
├── Web框架: Express.js 4.18.x
├── 数据库: SQLite 3.x
├── 文件处理: Node.js原生fs模块
├── HTTP客户端: Axios
├── 跨域处理: CORS
├── 身份验证: JWT
└── 文件上传: Multer
```

### AI集成
```
DeepSeek API
├── 模型: deepseek-chat
├── 功能: 代码分析、项目重组
├── 特性: 思考过程展示
└── 优化: 重复分析检测
```

## 📁 项目结构

```
code-web-dashboard/
├── public/                    # 前端静态资源
│   ├── index.html            # 主界面
│   ├── login.html            # 登录界面
│   └── app.js               # 前端主要逻辑（含拖拽排序）
├── dbconfig/                  # 数据库配置和脚本
│   ├── init-db.js           # 数据库初始化
│   ├── cleanup_*.sql        # 清理脚本
│   └── *.sql               # 其他数据库脚本
├── update/                    # 项目更新文档
│   ├── DESIGN-UPGRADE.md    # 设计升级说明
│   ├── IMPROVEMENTS.md      # 改进计划
│   ├── PROJECT-DELETE-FIX.md # 项目删除修复
│   ├── PROJECT-DRAG-SORT.md  # 拖拽排序功能说明
│   └── RESTRUCTURE-GUIDE.md # 目录重组指南
├── server.js                  # 后端服务器
├── package.json              # 项目配置
├── project_files.db          # SQLite数据库文件
└── README.md                 # 项目说明（本文件）
```

## ⚙️ 配置说明

### AI服务配置
在系统设置中配置DeepSeek API：
- **API URL**: `https://api.deepseek.com/v1/chat/completions`
- **API Key**: 从DeepSeek官网获取的API密钥

### 环境变量（可选）
```bash
# 生产环境建议使用环境变量
DEEPSEEK_API_KEY=your_api_key_here
PORT=3000
NODE_ENV=production
```

### 数据库配置
- **数据库类型**: SQLite
- **数据库文件**: `project_files.db`
- **初始化脚本**: `dbconfig/init-db.js`
- **清理脚本**: `dbconfig/cleanup_*.sql`

### 服务器配置
- **默认端口**: 3000
- **文件上传限制**: 50MB
- **支持的文件类型**: 所有文本文件
- **项目目录**: 支持本地任意目录

## 🔧 高级功能

### 🎪 拖拽排序技术细节
- **事件处理**: 基于HTML5 Drag & Drop API
- **数据持久化**: localStorage存储项目排序
- **视觉效果**: CSS3动画和过渡效果
- **错误处理**: 完善的拖拽失败恢复机制
- **性能优化**: 事件委托和防抖处理

#### 拖拽排序实现原理
```javascript
// 主要功能函数
- setupProjectDragAndDrop()  // 设置拖拽事件监听
- handleDragStart()          // 开始拖拽处理
- handleDrop()              // 拖拽放置处理
- saveProjectOrder()        // 保存排序到localStorage
- loadProjectOrder()        // 从localStorage加载排序
```

### 重复分析优化
- **智能检测**: 自动识别已分析的项目
- **选择对话框**: 提供查看现有结果或重新分析的选项
- **状态指示**: 清晰显示项目分析和重组状态

### 🔄 目录重组系统
- **AI智能分析**: 基于项目特点生成目录重组优化方案
- **永久保存配置**: 重组配置持久化存储，刷新页面不丢失
- **一键应用重组**: 快速应用AI推荐的目录结构优化
- **状态可视化**: 项目列表显示🪄魔法图标标识已重组项目
- **快速重置**: 随时一键恢复原始目录结构

#### 详细使用流程
1. **项目分析**: 选择项目 → 点击"项目分析" → 等待AI分析完成
2. **应用重组**: 在分析结果中点击"应用目录重组"按钮
3. **状态确认**: 项目列表中显示魔法图标🪄，表示重组已应用
4. **重置选项**: 需要时可点击"重置为原始结构"恢复

#### 技术实现
- **后端API**: `POST/GET/DELETE /api/projects/:projectId/restructure`
- **持久化**: SQLite数据库存储
- **状态管理**: 自动检测和应用保存的重组配置

### 安全特性
- **路径验证**: 防止目录遍历攻击
- **认证保护**: JWT Token身份验证
- **API限制**: AI接口调用频率控制
- **数据库安全**: SQLite事务处理和数据完整性

## 🧪 功能测试指南

### 拖拽排序功能测试
1. **基本拖拽测试**:
   ```
   添加多个项目 → 拖拽项目到不同位置 → 验证排序结果
   ```

2. **双向拖拽测试**:
   ```
   向上拖拽 → 验证排序 → 向下拖拽 → 验证排序
   ```

3. **持久化测试**:
   ```
   拖拽排序 → 刷新页面 → 验证排序保持 → 重启服务器 → 验证排序保持
   ```

4. **边界测试**:
   ```
   拖拽到第一位 → 拖拽到最后一位 → 拖拽到相同位置
   ```

### 目录重组功能测试
1. **基本重组流程**:
   ```
   添加新项目 → AI分析 → 应用重组 → 刷新页面 → 验证重组保持
   ```

2. **重置功能测试**:
   ```
   已重组项目 → AI分析 → 重置结构 → 验证恢复原始状态
   ```

3. **多项目并行测试**:
   ```
   对多个项目分别应用不同重组配置 → 验证配置互不影响
   ```

### 重复分析检测测试
- 对已分析项目再次点击"项目分析"
- 验证出现选择对话框：查看现有结果 vs 重新分析
- 测试两个选项的功能正确性

## 🔍 API接口文档

### 项目管理API
```http
GET    /api/projects              # 获取所有项目
POST   /api/projects              # 添加新项目
PUT    /api/projects/:id          # 更新项目信息
DELETE /api/projects/:id          # 删除项目
```

### 文件操作API
```http
GET    /api/projects/:id/files    # 获取项目文件列表
GET    /api/projects/:id/file     # 获取文件内容
POST   /api/search                # 搜索文件内容
```

### AI分析API
```http
POST   /api/analyze               # AI项目分析
GET    /api/projects/:id/restructure  # 获取重组配置
POST   /api/projects/:id/restructure  # 应用重组配置
DELETE /api/projects/:id/restructure  # 删除重组配置
```

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境搭建
1. Fork本项目
2. 创建特性分支: `git checkout -b feature/amazing-feature`
3. 提交更改: `git commit -m 'Add amazing feature'`
4. 推送分支: `git push origin feature/amazing-feature`
5. 提交Pull Request

### 代码规范
- 使用ES6+语法
- 遵循JavaScript Standard Style
- 添加必要的注释和文档
- 拖拽功能相关代码需要完整的错误处理

## 📄 许可证

本项目采用 [MIT License](LICENSE) 开源协议。

## 🛣️ 版本更新历史

### v1.3.0 (2025-01-23) - 文件树增强版本
- ✨ **新增**: 文件树高度可拖拽调整功能
- ✨ **新增**: 侧边栏宽度可拖拽调整功能
- 🎨 **优化**: 文件树展开/折叠控制按钮
- 💾 **增强**: 文件树高度和侧边栏宽度设置持久化保存
- � **响应式**: 移动端自适应布局优化
- �🔧 **改进**: 界面美化和用户体验全面提升

### v1.2.0 (2025-01-23) - 拖拽排序版本
- ✨ **新增**: 项目列表拖拽排序功能
- 🎨 **优化**: 拖拽视觉反馈和动画效果
- 💾 **增强**: localStorage数据持久化
- 🐛 **修复**: 双向拖拽排序逻辑
- 📚 **文档**: 完善拖拽功能使用说明

### v1.1.0 - AI增强版本
- ✨ 新增目录重组功能
- 🧠 集成DeepSeek AI分析
- 🔄 重复分析检测优化
- 🎨 界面设计升级

### v1.0.0 - 基础版本
- 🚀 基础项目管理功能
- 📁 文件浏览和代码高亮
- 🔐 JWT身份验证
- 💾 SQLite数据库集成

## 🔮 未来规划

### 拖拽功能扩展
- [ ] 拖拽排序撤销/重做功能
- [ ] 批量项目拖拽选择
- [ ] 拖拽排序的键盘快捷键支持
- [ ] 拖拽排序的动画优化

### 文件树功能扩展
- [ ] 文件树宽度调整功能
- [ ] 文件树位置可拖拽移动
- [ ] 文件树多标签页支持
- [ ] 文件树搜索过滤功能

### 侧边栏功能扩展
- [ ] 侧边栏分栏布局支持
- [ ] 侧边栏自动隐藏功能
- [ ] 侧边栏主题定制
- [ ] 侧边栏快捷键操作

### 目录重组功能扩展
- [ ] 数据库持久化存储优化
- [ ] 重组配置版本管理和历史记录
- [ ] 自定义重组模板和规则
- [ ] 重组配置导入/导出功能

### 其他功能扩展
- [ ] 代码搜索和替换功能
- [ ] 在线文件编辑器
- [ ] Git版本控制集成
- [ ] 代码比较和差异显示
- [ ] 项目统计分析和报告
- [ ] 多语言界面支持
- [ ] 暗色主题模式

## 🙏 致谢

- [DeepSeek](https://www.deepseek.com/) - 提供强大的AI分析能力
- [Highlight.js](https://highlightjs.org/) - 代码语法高亮
- [Font Awesome](https://fontawesome.com/) - 优秀的图标库
- [Express.js](https://expressjs.com/) - 快速的Node.js Web框架
- [SQLite](https://www.sqlite.org/) - 轻量级数据库引擎

## 🆘 故障排除

### 常见问题
1. **服务器启动失败**: 检查Node.js版本（需要16.x+）和端口占用
2. **AI分析失败**: 验证网络连接和DeepSeek API密钥配置
3. **文件无法显示**: 确认文件路径权限和文件编码
4. **拖拽功能不工作**: 检查浏览器是否支持HTML5 Drag & Drop API
5. **项目排序丢失**: 检查浏览器localStorage是否被清除
6. **文件树调整大小失效**: 确认浏览器支持CSS3和现代JavaScript
7. **侧边栏宽度调整不工作**: 检查鼠标拖拽事件是否被其他元素阻止

### 拖拽功能调试
```javascript
// 在浏览器控制台中检查拖拽事件
console.log('拖拽功能调试信息已开启');
// 查看详细的拖拽过程日志
```

### 日志查看
服务器运行时会在终端输出详细日志信息：
- 拖拽事件的完整流程
- 数据库操作记录
- API请求和响应
- 错误信息和堆栈跟踪

### 性能优化建议
- 定期清理SQLite数据库
- 限制同时管理的项目数量（建议<50个）
- 大型项目建议分模块管理

---

<p align="center">
  <strong>🎪 Made with ❤️ for better code exploration experience</strong><br>
  <em>支持拖拽排序，让项目管理更加直观高效！</em>
</p>

<p align="center">
  <a href="https://github.com/rrrrr9633/code-web-dashboard">⭐ 如果这个项目对您有帮助，请给我们一个星标！</a>
</p>
├── 跨域处理: CORS
└── 身份验证: JWT
```

### AI集成
```
DeepSeek API
├── 模型: deepseek-chat
├── 功能: 代码分析、项目重组
├── 特性: 思考过程展示
└── 优化: 重复分析检测
```

## 📁 项目结构

```
web-dashboard/
├── public/                 # 前端静态资源
│   ├── index.html         # 主界面
│   ├── login.html         # 登录界面
│   └── app.js            # 前端主要逻辑
├── server.js              # 后端服务器
├── package.json           # 项目配置
├── README.md             # 项目说明
├── ANALYSIS-OPTIMIZATION.md  # AI分析优化功能说明
├── RESTRUCTURE-GUIDE.md  # 目录重组功能使用指南
├── DESIGN-UPGRADE.md     # 设计升级说明
└── IMPROVEMENTS.md       # 改进计划
```

## ⚙️ 配置说明

### AI服务配置
在系统设置中配置DeepSeek API：
- **API URL**: `https://api.deepseek.com/v1/chat/completions`
- **API Key**: 从DeepSeek官网获取的API密钥

### 环境变量（可选）
```bash
# 生产环境建议使用环境变量
DEEPSEEK_API_KEY=your_api_key_here
PORT=3000
NODE_ENV=production
```

### 服务器配置
- **默认端口**: 3000
- **文件上传限制**: 50MB
- **支持的文件类型**: 所有文本文件
- **项目目录**: 支持本地任意目录

## 🔧 高级功能

### 重复分析优化
- **智能检测**: 自动识别已分析的项目
- **选择对话框**: 提供查看现有结果或重新分析的选项
- **状态指示**: 清晰显示项目分析和重组状态

### 🔄 目录重组系统
- **AI智能分析**: 基于项目特点生成目录重组优化方案
- **永久保存配置**: 重组配置持久化存储，刷新页面不丢失
- **一键应用重组**: 快速应用AI推荐的目录结构优化
- **状态可视化**: 项目列表显示🪄魔法图标标识已重组项目
- **快速重置**: 随时一键恢复原始目录结构

#### 详细使用流程
1. **项目分析**: 选择项目 → 点击"项目分析" → 等待AI分析完成
2. **应用重组**: 在分析结果中点击"应用目录重组"按钮
3. **状态确认**: 项目列表中显示魔法图标🪄，表示重组已应用
4. **重置选项**: 需要时可点击"重置为原始结构"恢复

#### 技术实现
- **后端API**: `POST/GET/DELETE /api/projects/:projectId/restructure`
- **持久化**: 服务器内存存储（可扩展为数据库）
- **状态管理**: 自动检测和应用保存的重组配置

### 安全特性
- **路径验证**: 防止目录遍历攻击
- **认证保护**: JWT Token身份验证
- **API限制**: AI接口调用频率控制

## 🧪 功能测试指南

### 目录重组功能测试
1. **基本重组流程**:
   ```
   添加新项目 → AI分析 → 应用重组 → 刷新页面 → 验证重组保持
   ```

2. **重置功能测试**:
   ```
   已重组项目 → AI分析 → 重置结构 → 验证恢复原始状态
   ```

3. **多项目并行测试**:
   ```
   对多个项目分别应用不同重组配置 → 验证配置互不影响
   ```

### 重复分析检测测试
- 对已分析项目再次点击"项目分析"
- 验证出现选择对话框：查看现有结果 vs 重新分析
- 测试两个选项的功能正确性

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境搭建
1. Fork本项目
2. 创建特性分支: `git checkout -b feature/amazing-feature`
3. 提交更改: `git commit -m 'Add amazing feature'`
4. 推送分支: `git push origin feature/amazing-feature`
5. 提交Pull Request

### 代码规范
- 使用ES6+语法
- 遵循JavaScript Standard Style
- 添加必要的注释和文档

## 📄 许可证

本项目采用 [MIT License](LICENSE) 开源协议。

## � 未来规划

### 目录重组功能扩展
- [ ] 数据库持久化存储（替换内存存储）
- [ ] 重组配置版本管理和历史记录
- [ ] 自定义重组模板和规则
- [ ] 重组配置导入/导出功能

### 其他功能扩展
- [ ] 代码搜索和替换功能
- [ ] 在线文件编辑器
- [ ] Git版本控制集成
- [ ] 代码比较和差异显示
- [ ] 项目统计分析和报告
- [ ] 多语言界面支持

## �🙏 致谢

- [DeepSeek](https://www.deepseek.com/) - 提供强大的AI分析能力
- [Highlight.js](https://highlightjs.org/) - 代码语法高亮
- [Font Awesome](https://fontawesome.com/) - 优秀的图标库
- [Express.js](https://expressjs.com/) - 快速的Node.js Web框架

---

<p align="center">
  Made with ❤️ for better code exploration experience
</p>

## 扩展功能

可以考虑添加的功能：
- 代码搜索功能
- 文件编辑功能
- Git集成
- 代码比较功能
- 项目统计分析
- 多语言支持

## 故障排除

### 常见问题
1. **服务器启动失败**: 检查Node.js是否正确安装
2. **AI分析失败**: 验证网络连接和API密钥
3. **文件无法显示**: 确认文件路径和权限

### 日志查看
服务器运行时会在终端输出日志信息，可以查看具体的错误信息。

---

**开发者**: FlowMQ Code Viewer  
**版本**: 1.0.0  
**许可证**: MIT
